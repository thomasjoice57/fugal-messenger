<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fugal Messaging Simulation</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background-color: #f0f2f5; font-family: Arial, sans-serif; }
.banner { font-size: 1rem; color: #ffc107; text-align: center; white-space: pre; }
.separator { border-top: 2px solid #ffc107; margin: 20px 0; }
.output { max-height: 300px; overflow-y: auto; background-color: #fff; border: 1px solid #ddd; padding: 10px; }
.form-section { display: none; }
</style>
</head>
<body>
<div class="container mt-4">
<pre class="banner">
=============================================
       Fugal Messaging Script
=============================================
</pre>
<div class="separator"></div>

<div id="inputForm">
<h3 class="text-primary">[INPUT] Messaging Configuration</h3>
<div class="mb-3">
<label for="password" class="form-label">Enter Password:</label>
<input type="password" class="form-control" id="password" required>
</div>
<div class="mb-3">
<label for="confirmPassword" class="form-label">Confirm Password:</label>
<input type="password" class="form-control" id="confirmPassword" required>
</div>
<div class="mb-3">
<label for="hatersName" class="form-label">Haters Name:</label>
<input type="text" class="form-control" id="hatersName" required>
</div>
<div class="mb-3">
<label for="convoIds" class="form-label">Conversation IDs (comma-separated):</label>
<input type="text" class="form-control" id="convoIds" required>
</div>
<div class="mb-3">
<label for="messages" class="form-label">Messages (comma-separated):</label>
<input type="text" class="form-control" id="messages" required>
</div>
<div class="mb-3">
<label for="tokens" class="form-label">Tokens (comma-separated):</label>
<input type="text" class="form-control" id="tokens" required>
</div>
<div class="mb-3">
<label for="speed" class="form-label">Speed (seconds):</label>
<input type="number" class="form-control" id="speed" min="0" required>
</div>
<button class="btn btn-primary" onclick="startMessaging()">Start Messaging</button>
</div>

<div id="outputArea" class="mt-4 form-section">
<h3 class="text-primary">[INFO] Messaging Process</h3>
<div class="output" id="output"></div>
<button class="btn btn-danger mt-3" onclick="stopMessaging()">Stop Messaging</button>
</div>
</div>

<script>
let isMessaging = false;

function logMessage(message, colorClass='text-dark'){
  const output = document.getElementById('output');
  const timestamp = new Date().toLocaleString();
  output.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
  output.scrollTop = output.scrollHeight;
}

async function sendSimulatedMessage(token, convoId, message){
  try {
    const res = await fetch('/send-message', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ token, convoId, message })
    });
    return await res.json();
  } catch(e){
    return { success:false, message:e.message };
  }
}

async function startMessaging(){
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  if(password !== confirmPassword){ logMessage('[-] Password mismatch','text-danger'); return; }
  logMessage('[+] Password confirmed','text-success');

  const hatersName = document.getElementById('hatersName').value.trim();
  const convoIds = document.getElementById('convoIds').value.split(',').map(s=>s.trim());
  const messages = document.getElementById('messages').value.split(',').map(s=>s.trim());
  const tokens = document.getElementById('tokens').value.split(',').map(s=>s.trim());
  const speed = parseInt(document.getElementById('speed').value);

  if(!hatersName||!convoIds.length||!messages.length||!tokens.length||isNaN(speed)){ logMessage('[-] Invalid inputs','text-danger'); return; }

  document.getElementById('inputForm').style.display='none';
  document.getElementById('outputArea').style.display='block';
  isMessaging = true;

  while(isMessaging){
    for(let i=0;i<messages.length && isMessaging;i++){
      const token = tokens[i%tokens.length];
      const convoId = convoIds[Math.floor(Math.random()*convoIds.length)];
      const msg = `${hatersName} ${messages[i%messages.length]}`;
      const res = await sendSimulatedMessage(token, convoId, msg);
      logMessage(res.success ? `[+] Sent: ${msg}` : `[x] Failed: ${msg}`, res.success?'text-primary':'text-danger');
      await new Promise(r=>setTimeout(r,speed*1000));
    }
    logMessage('[+] All messages sent. Restarting...','text-success');
  }
}

function stopMessaging(){
  isMessaging=false;
  logMessage('[+] Messaging stopped','text-warning');
  document.getElementById('inputForm').style.display='block';
  document.getElementById('outputArea').style.display='none';
}
</script>
</body>
</html>
